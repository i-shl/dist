<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <!-- 移动端适配：动态设置viewport，适配刘海屏 -->
  <script>
    // 检测设备是否支持安全区域适配
    const coverSupport = 'CSS' in window && typeof CSS.supports === 'function' &&
      (CSS.supports('top: env(safe-area-inset-top)') || CSS.supports('top: constant(safe-area-inset-top)'));

    // 动态设置viewport（必须在head中执行，避免闪烁）
    const viewport = document.createElement('meta');
    viewport.name = 'viewport';
    viewport.content = `width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0${coverSupport ? ', viewport-fit=cover' : ''}`;
    document.head.appendChild(viewport);
  </script>
  <title>bq-vue-h5</title>
  <script type="module" crossorigin src="/assets/js/index-CkGxQbP_.js"></script>
  <link rel="stylesheet" crossorigin href="/assets/index-DsJXVA2U.css">
</head>

<body>

  <div id="app"></div>
</body>
<!-- 引入uni.webview.js -->

<!-- 处理 uni 对象冲突（非常重要！） -->

<!-- 初始化uni变量 -->
<script type="text/javascript">
  var userAgent = navigator.userAgent;
  if (userAgent.indexOf('AlipayClient') > -1) {
    // 支付宝小程序的 JS-SDK 防止 404 需要动态加载，如果不需要兼容支付宝小程序，则无需引用此 JS 文件。
    document.writeln('<script src="https://appx/web-view.min.js"' + '>' + '<' + '/' + 'script>');
  } else if (/QQ/i.test(userAgent) && /miniProgram/i.test(userAgent)) {
    // QQ 小程序
    document.write(
      '<script type="text/javascript" src="https://qqq.gtimg.cn/miniprogram/webview_jssdk/qqjssdk-1.0.0.js"><\/script>'
    );
  } else if (/miniProgram/i.test(userAgent) && /micromessenger/i.test(userAgent)) {
    // 微信小程序 JS-SDK 如果不需要兼容微信小程序，则无需引用此 JS 文件。
    document.write('<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"><\/script>');
  } else if (/toutiaomicroapp/i.test(userAgent)) {
    // 头条小程序 JS-SDK 如果不需要兼容头条小程序，则无需引用此 JS 文件。
    document.write(
      '<script type="text/javascript" src="https://lf1-cdn-tos.bytegoofy.com/goofy/developer/jssdk/jssdk-1.2.0.js"><\/script>');
  } else if (/Lark|Feishu/i.test(userAgent)) {
    // 飞书小程序 JS-SDK
    document.write(
      '<script type="text/javascript" src="https://lf1-cdn-tos.bytegoofy.com/goofy/developer/jssdk/jssdk-1.2.0.js"><\/script>');
  } else if (/swan/i.test(userAgent)) {
    // 百度小程序 JS-SDK 如果不需要兼容百度小程序，则无需引用此 JS 文件。
    document.write(
      '<script type="text/javascript" src="https://b.bdstatic.com/searchbox/icms/searchbox/js/swan-2.0.18.js"><\/script>'
    );
  } else if (/quickapp/i.test(userAgent)) {
    // quickapp
    document.write('<script type="text/javascript" src="https://quickapp/jssdk.webview.min.js"><\/script>');
  }
</script>
<!-- uni 的 SDK -->
<script type="text/javascript" src="/static/uni.webview.1.5.6.js" ></script>

<!-- 检查 uni 对象冲突情况 -->
<script type="text/javascript">
  (function() {
    console.log('========== 开始检查 uni 对象冲突情况 ==========');
    
    // 延迟检查，确保 uni.webview.js 已加载
    setTimeout(function() {
      console.log('\n【1. 检查 window.uni 对象】');
      console.log('window.uni 是否存在:', typeof window.uni !== 'undefined');
      
      if (typeof window.uni !== 'undefined') {
        console.log('window.uni 的值:', window.uni);
        console.log('window.uni 的类型:', typeof window.uni);
        console.log('window.uni 是否为对象:', typeof window.uni === 'object');
        
        // 检查 uni 对象的属性
        console.log('\n【2. 检查 window.uni 对象的属性】');
        console.log('uni.postMessage 是否存在:', typeof window.uni.postMessage !== 'undefined');
        console.log('uni.postMessage 的类型:', typeof window.uni.postMessage);
        console.log('uni.postMessage 是否为函数:', typeof window.uni.postMessage === 'function');
        
        console.log('uni.navigateTo 是否存在:', typeof window.uni.navigateTo !== 'undefined');
        console.log('uni.navigateTo 的类型:', typeof window.uni.navigateTo);
        console.log('uni.navigateTo 是否为函数:', typeof window.uni.navigateTo === 'function');
        
        console.log('uni.webView 是否存在:', typeof window.uni.webView !== 'undefined');
        console.log('uni.webView 的值:', window.uni.webView);
        
        // 列出所有属性
        console.log('\n【3. window.uni 对象的所有属性】');
        var uniKeys = Object.keys(window.uni || {});
        console.log('uni 对象的属性列表:', uniKeys);
        
        // 检查是否有 postMessage 方法
        if (typeof window.uni.postMessage === 'function') {
          console.log('✅ uni.postMessage 是一个函数，可以调用');
          try {
            // 尝试调用，但不实际发送消息
            console.log('uni.postMessage 函数签名:', window.uni.postMessage.toString().substring(0, 200));
          } catch(e) {
            console.warn('无法获取 uni.postMessage 的函数签名:', e);
          }
        } else {
          console.warn('❌ uni.postMessage 不是一个函数或不存在');
          console.warn('这可能是 uni 对象冲突导致的！');
        }
      } else {
        console.warn('❌ window.uni 不存在！uni.webview.js 可能没有正确加载');
      }
      
      // 检查 webUni 对象
      console.log('\n【4. 检查 window.webUni 对象】');
      console.log('window.webUni 是否存在:', typeof window.webUni !== 'undefined');
      if (typeof window.webUni !== 'undefined') {
        console.log('window.webUni 的值:', window.webUni);
        console.log('webUni.postMessage 是否存在:', typeof window.webUni.postMessage !== 'undefined');
        console.log('webUni.postMessage 是否为函数:', typeof window.webUni.postMessage === 'function');
      } else {
        console.log('window.webUni 不存在（这是正常的，如果使用的是官方 uni.webview.js）');
      }
      
      // 检查 UniAppJSBridgeReady 事件
      console.log('\n【5. 检查 UniAppJSBridgeReady 事件】');
      console.log('window.UniAppJSBridge 是否存在:', typeof window.UniAppJSBridge !== 'undefined');
      console.log('window.UniAppJSBridge 的值:', window.UniAppJSBridge);
      
      // 监听 UniAppJSBridgeReady 事件
      document.addEventListener('UniAppJSBridgeReady', function() {
        console.log('\n【6. UniAppJSBridgeReady 事件已触发】');
        console.log('再次检查 window.uni:');
        console.log('window.uni:', window.uni);
        console.log('uni.postMessage:', window.uni?.postMessage);
        console.log('uni.postMessage 是否为函数:', typeof window.uni?.postMessage === 'function');
        
        if (window.uni && typeof window.uni.postMessage === 'function') {
          console.log('✅ 事件触发后，uni.postMessage 可用');
        } else {
          console.warn('❌ 事件触发后，uni.postMessage 仍不可用');
          console.warn('这可能是 uni 对象冲突导致的！');
        }
      }, { once: true });
      
      console.log('\n========== 检查完成 ==========');
      console.log('请查看上面的输出，确认是否存在冲突');
      console.log('如果 uni.postMessage 不是函数，说明存在冲突，需要使用 webUni 版本');
    }, 100);
  })();
</script>

</html>
