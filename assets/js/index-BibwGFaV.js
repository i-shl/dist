import{d as J,n as X,m as O,G as Z,q as le,r as D,aK as Ue,x as G,aa as ie,R as ye,y as M,ai as be,aQ as Ie,o as Se,C as te,a as l,an as ce,aR as Be,a1 as Q,ac as H,F as ue,T as q,H as de,I as Fe,B as Ae,A as ve,K as re,S as _,ag as $e,L as Pe,D as Ce,as as Xe,p as N,a5 as fe,U as xe,$ as K,af as Ye,aj as _e,ay as Ze,X as Me,ar as ke,Q as ne,aS as je,aT as Ve,aU as Re,aV as Ne,al as ze,a6 as He,ao as me,aW as We}from"./index-CPhkr4Pe.js";import{a as pe,S as Ge}from"./index-CGflKc6t.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"3a9292ca7a3904f73afa4ca8b96ef6af9893536b"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new e.Error().stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="32e29ed6-22d0-4c13-8102-4f31ef540166",e._sentryDebugIdIdentifier="sentry-dbid-32e29ed6-22d0-4c13-8102-4f31ef540166")})()}catch{}const[qe,j]=le("image"),Ke={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:Z,height:Z,radius:Z,lazyLoad:Boolean,iconSize:Z,showError:O,errorIcon:X("photo-fail"),iconPrefix:String,showLoading:O,loadingIcon:X("photo"),crossorigin:String,referrerpolicy:String,decoding:String};var Qe=J({name:qe,props:Ke,emits:["load","error"],setup(e,{emit:n,slots:c}){const a=D(!1),d=D(!0),i=D(),{$Lazyload:y}=Ue().proxy,P=G(()=>{const r={width:ie(e.width),height:ie(e.height)};return ye(e.radius)&&(r.overflow="hidden",r.borderRadius=ie(e.radius)),r});M(()=>e.src,()=>{a.value=!1,d.value=!0});const b=r=>{d.value&&(d.value=!1,n("load",r))},R=()=>{const r=new Event("load");Object.defineProperty(r,"target",{value:i.value,enumerable:!0}),b(r)},u=r=>{a.value=!0,d.value=!1,n("error",r)},g=(r,z,T)=>T?T():l(H,{name:r,size:e.iconSize,class:z,classPrefix:e.iconPrefix},null),h=()=>{if(d.value&&e.showLoading)return l("div",{class:j("loading")},[g(e.loadingIcon,j("loading-icon"),c.loading)]);if(a.value&&e.showError)return l("div",{class:j("error")},[g(e.errorIcon,j("error-icon"),c.error)])},w=()=>{if(a.value||!e.src)return;const r={alt:e.alt,class:j("img"),decoding:e.decoding,style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?ce(l("img",Q({ref:i},r),null),[[Be("lazy"),e.src]]):l("img",Q({ref:i,src:e.src,onLoad:b,onError:u},r),null)},C=({el:r})=>{const z=()=>{r===i.value&&d.value&&R()};i.value?z():te(z)},$=({el:r})=>{r===i.value&&!a.value&&u()};return y&&be&&(y.$on("loaded",C),y.$on("error",$),Ie(()=>{y.$off("loaded",C),y.$off("error",$)})),Se(()=>{te(()=>{var r;(r=i.value)!=null&&r.complete&&!e.lazyLoad&&R()})}),()=>{var r;return l("div",{class:j({round:e.round,block:e.block}),style:P.value},[w(),h(),(r=c.default)==null?void 0:r.call(c)])}}});const Le=ue(Qe),ge=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),Je=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),se=le("image-preview")[1],he=2.6,ea={src:String,show:Boolean,active:Number,minZoom:q(Z),maxZoom:q(Z),rootWidth:q(Number),rootHeight:q(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var aa=J({props:ea,emits:["scale","close","longPress"],setup(e,{emit:n,slots:c}){const a=de({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),d=Fe(),i=D(),y=D(),P=D(!1),b=D(!1);let R=0;const u=G(()=>{const{scale:o,moveX:s,moveY:f,moving:k,zooming:U,initializing:A}=a,ae={transitionDuration:U||k||A?"0s":".3s"};return(o!==1||b.value)&&(ae.transform=`matrix(${o}, 0, 0, ${o}, ${s}, ${f})`),ae}),g=G(()=>{if(a.imageRatio){const{rootWidth:o,rootHeight:s}=e,f=P.value?s/a.imageRatio:o;return Math.max(0,(a.scale*f-o)/2)}return 0}),h=G(()=>{if(a.imageRatio){const{rootWidth:o,rootHeight:s}=e,f=P.value?s:o*a.imageRatio;return Math.max(0,(a.scale*f-s)/2)}return 0}),w=(o,s)=>{var f;if(o=_(o,+e.minZoom,+e.maxZoom+1),o!==a.scale){const k=o/a.scale;if(a.scale=o,s){const U=Ce((f=i.value)==null?void 0:f.$el),A={x:U.width*.5,y:U.height*.5},ae=a.moveX-(s.x-U.left-A.x)*(k-1),Ee=a.moveY-(s.y-U.top-A.y)*(k-1);a.moveX=_(ae,-g.value,g.value),a.moveY=_(Ee,-h.value,h.value)}else a.moveX=0,a.moveY=b.value?R:0;n("scale",{scale:o,index:e.active})}},C=()=>{w(1)},$=()=>{const o=a.scale>1?1:2;w(o,o===2||b.value?{x:d.startX.value,y:d.startY.value}:void 0)};let r,z,T,m,E,L,Y,W,t=!1;const v=o=>{const{touches:s}=o;if(r=s.length,r===2&&e.disableZoom)return;const{offsetX:f}=d;d.start(o),z=a.moveX,T=a.moveY,W=Date.now(),t=!1,a.moving=r===1&&(a.scale!==1||b.value),a.zooming=r===2&&!f.value,a.zooming&&(m=a.scale,E=ge(s))},x=o=>{const{touches:s}=o;if(d.move(o),a.moving){const{deltaX:f,deltaY:k}=d,U=f.value+z,A=k.value+T;if((e.vertical?d.isVertical()&&Math.abs(A)>h.value:d.isHorizontal()&&Math.abs(U)>g.value)&&!t){a.moving=!1;return}t=!0,re(o,!0),a.moveX=_(U,-g.value,g.value),a.moveY=_(A,-h.value,h.value)}if(a.zooming&&(re(o,!0),s.length===2)){const f=ge(s),k=m*f/E;L=Je(s),w(k,L)}},I=o=>{var s;const f=(s=y.value)==null?void 0:s.$el;if(!f)return;const k=f.firstElementChild,U=o.target===f,A=k?.contains(o.target);!e.closeOnClickImage&&A||!e.closeOnClickOverlay&&U||n("close")},B=o=>{if(r>1)return;const s=Date.now()-W,f=250;d.isTap.value&&(s<f?e.doubleScale?Y?(clearTimeout(Y),Y=null,$()):Y=setTimeout(()=>{I(o),Y=null},f):I(o):s>Xe&&n("longPress"))},F=o=>{let s=!1;if((a.moving||a.zooming)&&(s=!0,a.moving&&z===a.moveX&&T===a.moveY&&(s=!1),!o.touches.length)){a.zooming&&(a.moveX=_(a.moveX,-g.value,g.value),a.moveY=_(a.moveY,-h.value,h.value),a.zooming=!1),a.moving=!1,z=0,T=0,m=1,a.scale<1&&C();const f=+e.maxZoom;a.scale>f&&w(f,L)}re(o,s),B(o),d.reset()},ee=()=>{const{rootWidth:o,rootHeight:s}=e,f=s/o,{imageRatio:k}=a;P.value=a.imageRatio>f&&k<he,b.value=a.imageRatio>f&&k>=he,b.value&&(R=(k*o-s)/2,a.moveY=R,a.initializing=!0,$e(()=>{a.initializing=!1})),C()},p=o=>{const{naturalWidth:s,naturalHeight:f}=o.target;a.imageRatio=f/s,ee()};return M(()=>e.active,C),M(()=>e.show,o=>{o||C()}),M(()=>[e.rootWidth,e.rootHeight],ee),Ae("touchmove",x,{target:G(()=>{var o;return(o=y.value)==null?void 0:o.$el})}),ve({resetScale:C}),()=>{const o={loading:()=>l(Pe,{type:"spinner"},null)};return l(pe,{ref:y,class:se("swipe-item"),onTouchstartPassive:v,onTouchend:F,onTouchcancel:F},{default:()=>[c.image?l("div",{class:se("image-wrap")},[c.image({src:e.src,onLoad:p,style:u.value})]):l(Le,{ref:i,src:e.src,fit:"contain",class:se("image",{vertical:P.value}),style:u.value,onLoad:p},o)]})}}});const[oa,V]=le("image-preview"),ta=["show","teleport","transition","overlayStyle","closeOnPopstate"],na={show:Boolean,loop:O,images:xe(),minZoom:N(1/3),maxZoom:N(3),overlay:O,vertical:Boolean,closeable:Boolean,showIndex:O,className:fe,closeIcon:X("clear"),transition:String,beforeClose:Function,doubleScale:O,overlayClass:fe,overlayStyle:Object,swipeDuration:N(300),startPosition:N(0),showIndicators:Boolean,closeOnPopstate:O,closeOnClickImage:O,closeOnClickOverlay:O,closeIconPosition:X("top-right"),teleport:[String,Object]};var Oe=J({name:oa,props:na,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:n,slots:c}){const a=D(),d=D(),i=de({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),y=()=>{if(a.value){const m=Ce(a.value.$el);i.rootWidth=m.width,i.rootHeight=m.height,a.value.resize()}},P=m=>n("scale",m),b=m=>n("update:show",m),R=()=>{ke(e.beforeClose,{args:[i.active],done:()=>b(!1)})},u=m=>{m!==i.active&&(i.active=m,n("change",m))},g=()=>{if(e.showIndex)return l("div",{class:V("index")},[c.index?c.index({index:i.active}):`${i.active+1} / ${e.images.length}`])},h=()=>{if(c.cover)return l("div",{class:V("cover")},[c.cover()])},w=()=>{i.disableZoom=!0},C=()=>{i.disableZoom=!1},$=()=>l(Ge,{ref:a,lazyRender:!0,loop:e.loop,class:V("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:u,onDragEnd:C,onDragStart:w},{default:()=>[e.images.map((m,E)=>l(aa,{ref:L=>{E===i.active&&(d.value=L)},src:m,show:e.show,active:i.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,disableZoom:i.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:P,onClose:R,onLongPress:()=>n("longPress",{index:E})},{image:c.image}))]}),r=()=>{if(e.closeable)return l(H,{role:"button",name:e.closeIcon,class:[V("close-icon",e.closeIconPosition),Me],onClick:R},null)},z=()=>n("closed"),T=(m,E)=>{var L;return(L=a.value)==null?void 0:L.swipeTo(m,E)};return ve({resetScale:()=>{var m;(m=d.value)==null||m.resetScale()},swipeTo:T}),Se(y),M([_e,Ze],y),M(()=>e.startPosition,m=>u(+m)),M(()=>e.show,m=>{const{images:E,startPosition:L}=e;m?(u(+L),te(()=>{y(),T(+L,{immediate:!0})})):n("close",{index:i.active,url:E[i.active]})}),()=>l(Ye,Q({class:[V(),e.className],overlayClass:[V("overlay"),e.overlayClass],onClosed:z,"onUpdate:show":b},K(e,ta)),{default:()=>[r(),$(),g(),h()]})}});let oe;const la={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function ia(){({instance:oe}=je({setup(){const{state:e,toggle:n}=Ve(),c=()=>{e.images=[]};return()=>l(Oe,Q(e,{onClosed:c,"onUpdate:show":n}),null)}}))}const ra=(e,n=0)=>{if(be)return oe||ia(),e=Array.isArray(e)?{images:e,startPosition:n}:e,oe.open(ne({},la,e)),oe};ue(Oe);const[sa,S,ca]=le("uploader");function we(e,n){return new Promise(c=>{if(n==="file"){c();return}const a=new FileReader;a.onload=d=>{c(d.target.result)},n==="dataUrl"?a.readAsDataURL(e):n==="text"&&a.readAsText(e)})}function Te(e,n){return Re(e).some(c=>c.file?Ne(n)?n(c.file):c.file.size>+n:!1)}function ua(e,n){const c=[],a=[];return e.forEach(d=>{Te(d,n)?a.push(d):c.push(d)}),{valid:c,invalid:a}}const da=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,va=e=>da.test(e);function De(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?va(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var fa=J({props:{name:Z,item:q(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:n,slots:c}){const a=()=>{const{status:u,message:g}=e.item;if(u==="uploading"||u==="failed"){const h=u==="failed"?l(H,{name:"close",class:S("mask-icon")},null):l(Pe,{class:S("loading")},null),w=ye(g)&&g!=="";return l("div",{class:S("mask")},[h,w&&l("div",{class:S("mask-message")},[g])])}},d=u=>{const{name:g,item:h,index:w,beforeDelete:C}=e;u.stopPropagation(),ke(C,{args:[h,{name:g,index:w}],done:()=>n("delete")})},i=()=>n("preview"),y=()=>n("reupload"),P=()=>{if(e.deletable&&e.item.status!=="uploading"){const u=c["preview-delete"];return l("div",{role:"button",class:S("preview-delete",{shadow:!u}),tabindex:0,"aria-label":ca("delete"),onClick:d},[u?u():l(H,{name:"cross",class:S("preview-delete-icon")},null)])}},b=()=>{if(c["preview-cover"]){const{index:u,item:g}=e;return l("div",{class:S("preview-cover")},[c["preview-cover"](ne({index:u},g))])}},R=()=>{const{item:u,lazyLoad:g,imageFit:h,previewSize:w,reupload:C}=e;return De(u)?l(Le,{fit:h,src:u.objectUrl||u.content||u.url,class:S("preview-image"),width:Array.isArray(w)?w[0]:w,height:Array.isArray(w)?w[1]:w,lazyLoad:g,onClick:C?y:i},{default:b}):l("div",{class:S("file"),style:ze(e.previewSize)},[l(H,{class:S("file-icon"),name:"description"},null),l("div",{class:[S("file-name"),"van-ellipsis"]},[u.file?u.file.name:u.url]),b()])};return()=>l("div",{class:S("preview")},[R(),a(),P()])}});const ma={name:N(""),accept:X("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:N(1/0),imageFit:X("cover"),resultType:X("dataUrl"),uploadIcon:X("photograph"),uploadText:String,deletable:O,reupload:Boolean,afterRead:Function,showUpload:O,modelValue:xe(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:O,previewOptions:Object,previewFullImage:O,maxSize:{type:[Number,String,Function],default:1/0}};var ga=J({name:sa,props:ma,emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:n,slots:c}){const a=D(),d=[],i=D(-1),y=D(!1),P=(t=e.modelValue.length)=>({name:e.name,index:t}),b=()=>{a.value&&(a.value.value="")},R=t=>{if(b(),Te(t,e.maxSize))if(Array.isArray(t)){const v=ua(t,e.maxSize);if(t=v.valid,n("oversize",v.invalid,P()),!t.length)return}else{n("oversize",t,P());return}if(t=de(t),i.value>-1){const v=[...e.modelValue];v.splice(i.value,1,t),n("update:modelValue",v),i.value=-1}else n("update:modelValue",[...e.modelValue,...Re(t)]);e.afterRead&&e.afterRead(t,P())},u=t=>{const{maxCount:v,modelValue:x,resultType:I}=e;if(Array.isArray(t)){const B=+v-x.length;t.length>B&&(t=t.slice(0,B)),Promise.all(t.map(F=>we(F,I))).then(F=>{const ee=t.map((p,o)=>{const s={file:p,status:"",message:"",objectUrl:URL.createObjectURL(p)};return F[o]&&(s.content=F[o]),s});R(ee)})}else we(t,I).then(B=>{const F={file:t,status:"",message:"",objectUrl:URL.createObjectURL(t)};B&&(F.content=B),R(F)})},g=t=>{const{files:v}=t.target;if(e.disabled||!v||!v.length)return;const x=v.length===1?v[0]:[].slice.call(v);if(e.beforeRead){const I=e.beforeRead(x,P());if(!I){b();return}if(We(I)){I.then(B=>{u(B||x)}).catch(b);return}}u(x)};let h;const w=()=>n("closePreview"),C=t=>{if(e.previewFullImage){const v=e.modelValue.filter(De),x=v.map(I=>(I.objectUrl&&!I.url&&I.status!=="failed"&&(I.url=I.objectUrl,d.push(I.url)),I.url)).filter(Boolean);h=ra(ne({images:x,startPosition:v.indexOf(t),onClose:w},e.previewOptions))}},$=()=>{h&&h.close()},r=(t,v)=>{const x=e.modelValue.slice(0);x.splice(v,1),n("update:modelValue",x),n("delete",t,P(v))},z=t=>{y.value=!0,i.value=t,te(()=>W())},T=()=>{y.value||(i.value=-1),y.value=!1},m=(t,v)=>{const x=["imageFit","deletable","reupload","previewSize","beforeDelete"],I=ne(K(e,x),K(t,x,!0));return l(fa,Q({item:t,index:v,onClick:()=>n(e.reupload?"clickReupload":"clickPreview",t,P(v)),onDelete:()=>r(t,v),onPreview:()=>C(t),onReupload:()=>z(v)},K(e,["name","lazyLoad"]),I),K(c,["preview-cover","preview-delete"]))},E=()=>{if(e.previewImage)return e.modelValue.map(m)},L=t=>n("clickUpload",t),Y=()=>{const t=e.modelValue.length<+e.maxCount,v=e.readonly?null:l("input",{ref:a,type:"file",class:S("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&i.value===-1,disabled:e.disabled,onChange:g,onClick:T},null);return c.default?ce(l("div",{class:S("input-wrapper"),onClick:L},[c.default(),v]),[[me,t]]):ce(l("div",{class:S("upload",{readonly:e.readonly}),style:ze(e.previewSize),onClick:L},[l(H,{name:e.uploadIcon,class:S("upload-icon")},null),e.uploadText&&l("span",{class:S("upload-text")},[e.uploadText]),v]),[[me,e.showUpload&&t]])},W=()=>{a.value&&!e.disabled&&a.value.click()};return Ie(()=>{d.forEach(t=>URL.revokeObjectURL(t))}),ve({chooseFile:W,reuploadFile:z,closeImagePreview:$}),He(()=>e.modelValue),()=>l("div",{class:S()},[l("div",{class:S("wrapper",{disabled:e.disabled})},[E(),Y()])])}});const ya=ue(ga);export{ya as U};
