import{d as b,r as w,i as S,a4 as C,aT as N,o as M,p as A,aL as B,x as h,X as d,a as y,s as T,a0 as _,C as m,A as v}from"./index-I_kz0OBq.js";import{_ as E}from"./_plugin-vue_export-helper-Ckl9UNWA.js";import{B as g}from"./index-BtS2tAlQ.js";import"./use-route-XeiR27OB.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};l.SENTRY_RELEASE={id:"f7e57e3c537ca0bc1e582f9ec803810f33e7d1e0"}}catch{}})();try{(function(){var l=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},c=new l.Error().stack;c&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[c]="4188904d-d624-4667-824b-9d515c3d6703",l._sentryDebugIdIdentifier="sentry-dbid-4188904d-d624-4667-824b-9d515c3d6703")})()}catch{}const K=b({name:"TiandituMap",__name:"Map",props:{center:{default:()=>[116.397428,39.90923]},zoom:{default:10},mapType:{default:"TMAP_NORMAL_MAP"},apiKey:{default:"dbbcf35162406f7e2beb641dc342a88d"},style:{default:()=>({width:"100%",height:"400px"})}},emits:["mapReady","error"],setup(l,{emit:c}){const o=l,p=c,u=w(null);let r=null,i=!1,n=null,a=null;const I=S(()=>({width:o.style?.width||"100%",height:o.style?.height||"400px"}));function P(){return new Promise((e,t)=>{if(window.T&&window.T.Map){i=!0,e();return}if(i){const R=setInterval(()=>{window.T&&window.T.Map&&(clearInterval(R),i=!0,e())},100);return}const f=document.querySelector('script[src*="api.tianditu.gov.cn"]');if(f){f.addEventListener("load",()=>{i=!0,e()}),f.addEventListener("error",()=>{t(new Error("天地图脚本加载失败"))});return}const s=document.createElement("script");s.src=`http://api.tianditu.gov.cn/api?v=4.0&tk=${o.apiKey}`,s.type="text/javascript",s.async=!0,s.onload=()=>{setTimeout(()=>{window.T&&window.T.Map?(i=!0,e()):t(new Error("天地图 API 初始化失败"))},100)},s.onerror=()=>{t(new Error("天地图脚本加载失败"))},document.head.appendChild(s)})}function x(){let e,t;switch(o.mapType){case"TMAP_SATELLITE_MAP":e="img_w",t="cia_w";break;case"TMAP_TERRAIN_MAP":e="ter_w",t="cta_w";break;default:e="vec_w",t="cva_w";break}return{baseLayerType:e,labelLayerType:t}}function L(){if(!r)return;const e=window.T;if(!e||!e.TileLayer){console.error("天地图 API 未正确加载");return}try{if(n){try{r.removeLayer(n)}catch(s){console.warn("移除底图图层失败:",s)}n=null}if(a){try{r.removeLayer(a)}catch(s){console.warn("移除标注图层失败:",s)}a=null}const{baseLayerType:t,labelLayerType:f}=x();console.log("添加图层:",{baseLayerType:t,labelLayerType:f,apiKey:o.apiKey}),n=new e.TileLayer(t,{tk:o.apiKey}),r.addLayer(n),console.log("底图图层已添加:",n),a=new e.TileLayer(f,{tk:o.apiKey}),r.addLayer(a),console.log("标注图层已添加:",a)}catch(t){console.error("添加图层失败:",t)}}function k(){if(!u.value)return;const e=window.T;if(!e||!e.Map){console.error("天地图 API 未加载，T.Map 不存在");return}try{console.log("开始初始化地图，容器:",u.value),r=new e.Map(u.value),console.log("地图实例已创建:",r);const t=new e.LngLat(o.center[0],o.center[1]);r.centerAndZoom(t,o.zoom),console.log("地图中心点和缩放已设置:",{center:o.center,zoom:o.zoom}),setTimeout(()=>{L(),p("mapReady",r)},200)}catch(t){console.error("地图初始化失败:",t),p("error",t instanceof Error?t:new Error(String(t)))}}function z(){if(!r)return;const e=window.T;if(e)try{const t=new e.LngLat(o.center[0],o.center[1]);r.centerAndZoom(t,o.zoom)}catch(t){console.error("地图更新失败:",t)}}return C(async()=>{try{await P(),k()}catch(e){console.error("地图加载失败:",e)}}),N(()=>{r&&(n&&(r.removeLayer(n),n=null),a&&(r.removeLayer(a),a=null),r=null)}),M(()=>[o.center,o.zoom],()=>{z()},{deep:!0}),M(()=>o.mapType,()=>{r&&L()}),(e,t)=>(h(),A("div",{ref_key:"mapContainer",ref:u,style:B(I.value),class:"tianditu-map-container"},null,4))}}),D=E(K,[["__scopeId","data-v-61cb5752"]]),$={class:"map-example-container"},O={class:"header"},V={class:"controls"},Z={class:"info"},q=b({__name:"MapExample",setup(l){const c=w([116.397428,39.90923]),o=w(10),p=w("TMAP_NORMAL_MAP");function u(i){console.log("天地图已初始化",i)}function r(i){p.value=i}return(i,n)=>(h(),A("div",$,[d("div",O,[n[6]||(n[6]=d("h2",null,"天地图示例",-1)),d("div",V,[y(_(g),{size:"small",onClick:n[0]||(n[0]=a=>r("TMAP_NORMAL_MAP"))},{default:T(()=>[...n[3]||(n[3]=[v("矢量图",-1)])]),_:1}),y(_(g),{size:"small",onClick:n[1]||(n[1]=a=>r("TMAP_SATELLITE_MAP"))},{default:T(()=>[...n[4]||(n[4]=[v("影像图",-1)])]),_:1}),y(_(g),{size:"small",onClick:n[2]||(n[2]=a=>r("TMAP_TERRAIN_MAP"))},{default:T(()=>[...n[5]||(n[5]=[v("地形图",-1)])]),_:1})])]),y(D,{center:c.value,zoom:o.value,"map-type":p.value,style:{width:"100%",height:"500px"},onMapReady:u},null,8,["center","zoom","map-type"]),d("div",Z,[d("p",null,"当前中心点: "+m(c.value[0])+", "+m(c.value[1]),1),d("p",null,"当前缩放级别: "+m(o.value),1),d("p",null,"当前地图类型: "+m(p.value),1)])]))}}),G=E(q,[["__scopeId","data-v-641bc1de"]]);export{G as default};
